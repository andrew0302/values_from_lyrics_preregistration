---
title: "4_check_duplicates"
author: "Andrew M. Demetriou"
date: "2023-04-06"
output: html_document
---

```{r}
library('here')
library('data.table')
library('dplyr')
library('stringr')
library('tidyr')

load(file = here("VI_data_collection_november_2022", "intermediary_data", "all_dt.RDS"))
```

```{r}
# pivot raw data to long format
 all_dt_long <- all_dt |> 
  
  # pivot longer had an issue with mixed column types
  # make everything a character vector
  mutate(across(everything(), as.character)) |>
  
  # pivot to long format
  pivot_longer(
    
    # range of columns
    #cols = `828136-w`:`1027136-r`, 
    #cols = `828136-w`:`2107983-r`, 
    cols = `828136-w`:`213759518-r`, 
  
    # two new columns: song and question
    names_to = c('song', 'question'),
  
    # separate names by "-"
    names_sep = "-", 
  
    # new columns for participant responses
    values_to = "response", 
  
    # drop empty cells
    values_drop_na = TRUE
)
```

```{r}
# check for duplicates
all_dt_long %>%
  dplyr::group_by(PROLIFIC_PID, song, question) %>%
  #dplyr::group_by(ResponseId, song, question) %>%
  dplyr::summarise(n = dplyr::n(), .groups = "drop") %>%
  dplyr::filter(n > 1L)

# same PROLIFIC_PID for two response IDs:
# R_Dp1VL9Eduv8pRV7, R_2456rueICK0vyBX
```

```{r}
#dupe_df <- all_dt[ResponseId == "R_Dp1VL9Eduv8pRV7" | ResponseId == "R_2456rueICK0vyBX"]

de_dupe_df <- all_dt
de_dupe_df <- de_dupe_df[ResponseId != "R_Dp1VL9Eduv8pRV7"]
de_dupe_df <- de_dupe_df[ResponseId != "R_2456rueICK0vyBX"]

rm(all_dt, all_dt_long)
```


